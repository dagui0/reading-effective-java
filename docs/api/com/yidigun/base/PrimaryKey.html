<!DOCTYPE HTML>
<html lang="ko">
<head>
<!-- Generated by javadoc (23) -->
<title>PrimaryKey (reading-effective-java unspecified)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: com.yidigun.base, interface: PrimaryKey">
<meta name="generator" content="javadoc/ClassWriter">
<link rel="stylesheet" type="text/css" href="../../../resource-files/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../resource-files/stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script-files/script.js"></script>
<script type="text/javascript" src="../../../script-files/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../script-files/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">const pathtoroot = "../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="nav-content">
<div class="nav-menu-button"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button></div>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../search.html">Search</a></li>
<li><a href="../../../help-doc.html#class">Help</a></li>
</ul>
</div>
</div>
<div class="sub-nav">
<div class="nav-content">
<ol class="sub-nav-list">
<li><a href="package-summary.html">com.yidigun.base</a></li>
<li><a href="PrimaryKey.html" class="current-selection">PrimaryKey</a></li>
</ol>
<div class="nav-list-search">
<input type="text" id="search-input" disabled placeholder="Search" aria-label="Search in documentation" autocomplete="off">
<input type="reset" id="reset-search" disabled value="Reset">
</div>
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="main-grid">
<nav role="navigation" class="toc" aria-label="Table of contents">
<div class="toc-header">Contents&nbsp;
<input type="text" class="filter-input" disabled placeholder="Filter" aria-label="Filter table of contents" autocomplete="off">
<input type="reset" class="reset-filter" disabled value="Reset">
</div>
<button class="hide-sidebar"><span>Hide sidebar&nbsp;</span>&#10094;</button><button class="show-sidebar">&#10095;<span>&nbsp;Show sidebar</span></button>
<ol class="toc-list">
<li><a href="#" tabindex="0">Description</a></li>
</ol>
</nav>
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<h1 title="Interface PrimaryKey" class="title">Interface PrimaryKey</h1>
</div>
<section class="class-description" id="class-description">
<div class="horizontal-scroll">
<dl class="notes">
<dt>All Known Implementing Classes:</dt>
<dd><code><a href="examples/Address.Key.html" title="class in com.yidigun.base.examples">Address.Key</a></code>, <code><a href="examples/ComplexKeyExample.Key.html" title="class in com.yidigun.base.examples">ComplexKeyExample.Key</a></code>, <code><a href="examples/MemberKey.html" title="class in com.yidigun.base.examples">MemberKey</a></code>, <code><a href="examples/Post.Key.html" title="class in com.yidigun.base.examples">Post.Key</a></code>, <code><a href="examples/ResidentKey.html" title="class in com.yidigun.base.examples">ResidentKey</a></code>, <code><a href="examples/SimpleKeyExample.Key.html" title="class in com.yidigun.base.examples">SimpleKeyExample.Key</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public interface </span><span class="element-name type-name-label">PrimaryKey</span></div>
<div class="block"><p><a href="DomainObject.html" title="interface in com.yidigun.base"><code>DomainObject</code></a>의 Primary Key의 값을 담는 DTO(Data transfer object) 인터페이스.
이 인터페이스는 PK만을 비교할 때 사용하거나, <a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link"><code>Map</code></a>의 키로 사용해야 할 경우 사용할 수 있다.</p>
<p>이 인터페이스는 단순한 마커 인터페이스로 구현해야 할 메소드는 없다.
하지만 DB 조회용 클래스를 위한 디자인 패턴에서 핵심적인 중심으로 작용한다.</p>
<p>단순 키(단일컬럼)를 사용하는 경우에도 반드시 Key용 클래스를 만드는 것이 좋은데
그 이유는 보통 PK에 사용되는 <code>int(Integer)</code>, <code>long(Long)</code>, <code>String</code> 등의
기본 타입은 범용 타입이라서 어느 테이블의 키인지 확인할 수 없기 때문이다.</p>
<p>키 전용 래핑 클래스를 만들게 되면 타입 안전성이 향상되고 버그 발생 가능성이 많이 줄어들 수 있다.</p>
<h3 id="--heading">추가 인터페이스 구현</h3>
<p>필요에 따라 <a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/Comparable.html" title="class or interface in java.lang" class="external-link"><code>Comparable</code></a>이나, <a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/CharSequence.html" title="class or interface in java.lang" class="external-link"><code>CharSequence</code></a> 등을 추가로 구현할 수 있다.</p>
<h4 id="--heading1"><a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/Comparable.html" title="class or interface in java.lang" class="external-link"><code>Comparable</code></a> 구현</h4>
<p>정렬에 사용될 수 있게 하려면 <a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/Comparable.html" title="class or interface in java.lang" class="external-link"><code>Comparable</code></a>를 추가로 구현할 수 있다.</p>
<pre><code>public class Example implements DomainObject&lt;Example.Key&gt; {
    primary int no; // primary key
    public static record Key(int no) implements PrimaryKey, Comparable&lt;Key&gt; {
        @Override
        public int compareTo(@NotNull Key key) {
            return Integer.compare(this.no, key.no());
        }
    }
    @Override
    public Key getPrimaryKey() {
       return new Key(no);
    }
}

TreeMap&lt;Example.Key, Example&gt; map = new TreeMap&lt;&gt;();
map.put(example.getPrimaryKey(), example);
</code></pre>
<h4 id="--heading2"><a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/CharSequence.html" title="class or interface in java.lang" class="external-link"><code>CharSequence</code></a> 구현</h4>
<p>만약 키의 정의가 고정 자리수별로 특정한 의미를 나타내는 경우(Structured &amp; Semantic Key)
<a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/CharSequence.html" title="class or interface in java.lang" class="external-link"><code>CharSequence</code></a>를 구현하여 편의기능을 추가할 수 있다.</p>
<pre><code>public record ResidentId(String residentId) implements PrimaryKey, CharSequence {
    public boolean isMale() { return valueAt(7) % 2 == 1; }
    public boolean isFemale() { return valueAt(7) % 2 == 0; }
    public int valueAt(int index) { return Character.getNumericValue(charAt(index)); }
    @Override
    public int length() { return residentId.length(); }
    @Override
    public char charAt(int index) { return residentId.charAt(index); }
    @Override
    public @NotNull String subSequence(int start, int end) {
        return (String)residentId.subSequence(start, end);
    }
}

ResidentId residentId = new ResidentId(&quot;1111111111118&quot;);
String birthday = residentId.subSequence(0, 6);
assertTrue(residentId.isMale());
</code></pre>
<h3 id="key--heading">Key 타입을 독립 클래스로 만들 것인지 중첩 클래스로 만들 것인지</h3>
<p>특정 테이블의 PK가 여러 테이블에서 FK로 많이 사용되는 경우 독립된 클래스로 만드는 것이 좋다.(예: 회원번호 등)
반면에 한 테이블에서만 사용하거나, 컬럼 수가 많은 복합키인 경우 등은 간단하게 중첩 클래스로 만드는 것이 편리하다.</p>
<h4 id="--heading3">독립 클래스 예시</h4>
<pre><code>/// memberNo는 Member테이블의 PK
public record MemberKey(long memberNo) implements PrimaryKey, Comparable&lt;MemberKey&gt; {
    ...
    public static MemberKey of(long memberNo) { return new MemberKey(memberNo); }
    public long longValue() { return memberNo; }
    ...
    /// memberNo를 PK또는 필드에 사용하는 테이블용 인터페이스
    /// 기본 메소드를 이용하여 메소드를 미리 구현해 놓는다. (Java 8 이상)
    public interface Aware {
        default MemberKey getMemberKey() { return MemberKey.of(getMemberNo()); }
        long getMemberNo(); // lombok @Getter 사용하여 생성 가능

        /// Aware 객체를 만드는 빌더용 인터페이스 (long과 MemberKey를 변환하기 위한)
        public interface Builder&lt;B extends Builder&lt;B&gt;&gt; {
            default B memberKey(MemberKey key) { return memberNo(key.longValue()); }
            B memberNo(long memberNo); // lombok @Builder 사용하여 생성 가능
        }
    }
    ...
}

/// PK의 원본 테이블
@Getter
@Builder(toBuilder = true)
public class Member implements DomainObject&lt;MemberKey&gt;, MemberKey.Aware {
    private long memberNo; // primary key
    ...
    public MemberKey getPrimaryKey() { return MemberKey.of(memberNo); }
    ...
    public static class MemberBuilder implements MemberKey.Aware.Builder&lt;MemberBuilder&gt; {}
    ...
}

/// 부모 테이블의 PK를 상속받은 복합키 테이블(식별관계, Identifying Relationship)
@Getter
@Builder(toBuilder = true)
public class Address implements DomainObject&lt;Address.Key&gt;, MemberKey.Aware {
    private long memberNo; // primary key from foreign table
    private long addressNo; // primary key
    ...
    public Address.Key getPrimaryKey() { return new Address.Key(memberNo, addressNo); }
    ...
    // Address.Key 역시 MemberKey.Aware임
    // 단, record 클래스에는 @Getter를 붙일 수 없다.
    public static record Key(long memberNo, long addressNo) implements PrimaryKey, MemberKey.Aware {
        @Override public long getMemberNo() { return memberNo; }
    }
    ...
    public static class AddressBuilder implements MemberKey.Aware.Builder&lt;AddressBuilder&gt; {
        AddressBuilder addressKey(Address.Key key) {
            return memberNo(key.memberNo())
                  .addressNo(key.addressNo());
        }
    }
    ...
}

/// 부모 테이블의 PK를 단순 참조키로 사용하는 테이블(비식별관계, Non-identifying Relationship)
@Getter
@Builder(toBuilder = true)
public class Post implements DomainObject&lt;Post.Key&gt;, MemberKey.Aware {
    private long postNo; // primary key
    private String content; // semantic field
    private long memberNo; // semantic field from Member
    ...
    @Override public Post.Key getPrimaryKey() { return new Post.Key(postNo); }
    public static record Key(long postNo) implements PrimaryKey {}
    public static class PostBuilder implements MemberKey.Aware.Builder&lt;PostBuilder&gt; {}
    ...
 }
</code></pre>
</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="DomainObject.html" title="interface in com.yidigun.base">DomainObject(도메인 객체 인터페이스)</a></li>
<li><a href="examples/MemberKey.html" title="class in com.yidigun.base.examples">MemberKey(독립 클래스방식 구현 예시)</a></li>
<li><a href="examples/ResidentKey.html" title="class in com.yidigun.base.examples">ResidendId(Semantic Key 예시 (주민등록번호))</a></li>
</ul>
</dd>
</dl>
</div>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</body>
</html>
